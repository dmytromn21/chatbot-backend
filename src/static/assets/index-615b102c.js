import{bn as e,bo as ne,bp as ae,bq as oe,r as c,br as re,bs as ie,bt as ce,bu as le,bv as de,bw as he,bx as ue,by as me,bz as pe,bA as ge,bB as _e}from"./vendor-77d51360.js";import{S as xe,E as fe,a as je,b as ve,D as Ce,c as ye}from"./fluentui-icons-a178d016.js";import{S as x,I as be,P as Se,T as V,a as we,B as H,b as Te,c as Ne,D as Le,d as ke,e as Ae,C as Ie,f as Me,g as Pe}from"./fluentui-react-086df4e2.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();const Ee="_layout_f3hmh_1",Be="_header_f3hmh_13",Re="_headerContainer_f3hmh_23",qe="_headerTitleContainer_f3hmh_39",$e="_headerLogo_f3hmh_55",Oe="_headerTitle_f3hmh_39",He="_headerRightText_f3hmh_73",w={layout:Ee,header:Be,headerContainer:Re,headerTitleContainer:qe,headerLogo:$e,headerTitle:Oe,headerRightText:He},Fe=()=>e.jsxs("div",{className:w.layout,children:[e.jsx("header",{className:w.header,role:"banner",children:e.jsxs("div",{className:w.headerContainer,children:[e.jsx(ne,{to:"/",className:w.headerTitleContainer,children:e.jsx("h3",{className:w.headerTitle,children:"Alex's RAG for Events"})}),e.jsx("h4",{className:w.headerRightText,children:"OpenAI + PostgreSQL"})]})}),e.jsx(ae,{})]}),Qe="_container_1eier_1",Ge="_chatRoot_1eier_15",ze="_chatContainer_1eier_25",De="_chatEmptyState_1eier_41",Ve="_chatEmptyStateTitle_1eier_61",Ue="_chatEmptyStateSubtitle_1eier_75",Ke="_chatMessageStream_1eier_107",We="_chatMessageGpt_1eier_131",Je="_chatMessageGptMinWidth_1eier_145",Xe="_chatInput_1eier_155",Ye="_chatAnalysisPanel_1eier_181",Ze="_chatSettingsSeparator_1eier_197",et="_loadingLogo_1eier_209",tt="_commandsContainer_1eier_217",st="_commandButton_1eier_227",d={container:Qe,chatRoot:Ge,chatContainer:ze,chatEmptyState:De,chatEmptyStateTitle:Ve,chatEmptyStateSubtitle:Ue,chatMessageStream:Ke,chatMessageGpt:We,chatMessageGptMinWidth:Je,chatInput:Xe,chatAnalysisPanel:Ye,chatSettingsSeparator:Ze,loadingLogo:et,commandsContainer:tt,commandButton:st};var v=(t=>(t.Hybrid="hybrid",t.Vectors="vectors",t.Text="text",t))(v||{});const nt="_answerContainer_1gvux_1",at="_answerLogo_1gvux_21",ot="_answerText_1gvux_29",rt="_selected_1gvux_67",it="_referenceMetadata_1gvux_75",ct="_citationLearnMore_1gvux_85",lt="_citation_1gvux_85",dt="_followupQuestionsList_1gvux_129",ht="_followupQuestionLearnMore_1gvux_137",ut="_followupQuestion_1gvux_129",mt="_supContainer_1gvux_175",pt="_retryButton_1gvux_233",gt="_loadingdots_1gvux_277",_t="_loading_1gvux_277",_={answerContainer:nt,answerLogo:at,answerText:ot,selected:rt,referenceMetadata:it,citationLearnMore:ct,citation:lt,followupQuestionsList:dt,followupQuestionLearnMore:ht,followupQuestion:ut,supContainer:mt,retryButton:pt,loadingdots:gt,loading:_t};function xt(t,s,a){const l=[];let n=t.trim();if(s){let p=n.length;for(let m=n.length-1;m>=0&&n[m]!=="]";m--)if(n[m]==="["){p=m;break}n=n.substring(0,p)}return{answerHtml:n.split(/\[([^\]]+)\]/g).map((p,f)=>{if(f%2===0)return p;{let m;return l.indexOf(p)!==-1?m=l.indexOf(p)+1:(l.push(p),m=l.length),oe(e.jsx("a",{className:"supContainer",title:p,children:e.jsx("sup",{children:m})}))}}).join(""),citations:l}}const U=()=>e.jsx(xe,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),ft=({answer:t,isSelected:s,isStreaming:a,onCitationClicked:l,onThoughtProcessClicked:n,onSupportingContentClicked:r,onFollowupQuestionClicked:u,showFollowupQuestions:p})=>{const f=t.context.followup_questions,m=t.message.content,h=c.useMemo(()=>xt(m,a),[t]),C=re.sanitize(h.answerHtml);return e.jsxs(x,{className:`${_.answerContainer} ${s&&_.selected}`,verticalAlign:"space-between",children:[e.jsx(x.Item,{children:e.jsxs(x,{horizontal:!0,horizontalAlign:"space-between",children:[e.jsx(U,{}),e.jsx("div",{children:e.jsx(be,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>n(),disabled:!t.context.thoughts?.length})})]})}),e.jsx(x.Item,{grow:!0,children:e.jsx("div",{className:_.answerText,dangerouslySetInnerHTML:{__html:C}})}),!!h.citations.length&&e.jsx(x.Item,{children:e.jsxs(x,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e.jsx("span",{className:_.citationLearnMore,children:"References:"}),e.jsx("ol",{children:h.citations.map((g,y)=>{const j=t.context.data_points[g];return j?e.jsxs("li",{children:[e.jsx("h4",{children:j.name}),e.jsxs("p",{className:_.referenceMetadata,children:["Category: ",j.category]}),e.jsxs("p",{className:_.referenceMetadata,children:["Price: ",j.price]}),e.jsxs("p",{className:_.referenceMetadata,children:["Date: ",j.start_date_typed]}),e.jsx("p",{children:j.description})]},g):null})})]})}),!!f?.length&&p&&u&&e.jsx(x.Item,{children:e.jsxs(x,{horizontal:!0,wrap:!0,className:`${h.citations.length?_.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e.jsx("span",{className:_.followupQuestionLearnMore,children:"Follow-up questions:"}),f.map((g,y)=>e.jsx("a",{className:_.followupQuestion,title:g,onClick:()=>u(g),children:`${g}`},y))]})})]})},jt=()=>{const t=ie({from:{opacity:0},to:{opacity:1}});return e.jsx(ce.div,{style:{...t},children:e.jsxs(x,{className:_.answerContainer,verticalAlign:"space-between",children:[e.jsx(U,{}),e.jsx(x.Item,{grow:!0,children:e.jsxs("p",{className:_.answerText,children:["Generating answer",e.jsx("span",{className:_.loadingdots})]})})]})})},vt=({error:t,onRetry:s})=>e.jsxs(x,{className:_.answerContainer,verticalAlign:"space-between",children:[e.jsx(fe,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e.jsx(x.Item,{grow:!0,children:e.jsx("p",{className:_.answerText,children:t})}),e.jsx(Se,{className:_.retryButton,onClick:s,text:"Retry"})]}),Ct="_questionInputContainer_1nmg4_1",yt="_questionInputTextArea_1nmg4_23",bt="_questionInputButtonsContainer_1nmg4_33",q={questionInputContainer:Ct,questionInputTextArea:yt,questionInputButtonsContainer:bt},St=({onSend:t,disabled:s,placeholder:a,clearOnSend:l,initQuestion:n})=>{const[r,u]=c.useState("");c.useEffect(()=>{n&&u(n)},[n]);const p=()=>{s||!r.trim()||(t(r),l&&u(""))},f=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),p())},m=(h,C)=>{C?C.length<=1e3&&u(C):u("")};return e.jsxs(x,{horizontal:!0,className:q.questionInputContainer,children:[e.jsx(V,{className:q.questionInputTextArea,placeholder:a,multiline:!0,resizable:!1,borderless:!0,value:r,onChange:m,onKeyDown:f}),e.jsx("div",{className:q.questionInputButtonsContainer,children:e.jsx(we,{content:"Ask question button",relationship:"label",children:e.jsx(H,{size:"large",icon:e.jsx(je,{primaryFill:"rgba(115, 118, 225, 1)"}),onClick:p})})})]})},wt="_examplesNavList_1nagk_1",Tt="_example_1nagk_1",Nt="_exampleText_1nagk_57",O={examplesNavList:wt,example:Tt,exampleText:Nt},Lt=({text:t,value:s,onClick:a})=>e.jsx("div",{className:O.example,onClick:()=>a(s),children:e.jsx("p",{className:O.exampleText,children:t})}),kt=["Inspire me with an event tonight","What sports events are upcoming?","Any must-see events in the next few weeks?"],At=({onExampleClicked:t})=>e.jsx("ul",{className:O.examplesNavList,children:kt.map((s,a)=>e.jsx("li",{children:e.jsx(Lt,{text:s,value:s,onClick:t})},a))}),It="_container_1atyp_1",Mt="_message_1atyp_17",D={container:It,message:Mt},$=({message:t})=>e.jsx("div",{className:D.container,children:e.jsx("div",{className:D.message,children:t})}),Pt="_thoughtProcess_b834q_1",Et="_tList_b834q_15",Bt="_tListItem_b834q_27",Rt="_tStep_b834q_79",qt="_tCodeBlock_b834q_93",$t="_tProp_b834q_101",Ot="_citationImg_b834q_119",A={thoughtProcess:Pt,tList:Et,tListItem:Bt,tStep:Rt,tCodeBlock:qt,tProp:$t,citationImg:Ot};var T=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(T||{});const Ht=({thoughts:t})=>e.jsx("ul",{className:A.tList,children:t.map((s,a)=>e.jsxs("li",{className:A.tListItem,children:[e.jsx("div",{className:A.tStep,children:s.title}),e.jsx(x,{horizontal:!0,tokens:{childrenGap:5},children:s.props&&(Object.keys(s.props)||[]).map(l=>e.jsxs("span",{className:A.tProp,children:[l,": ",JSON.stringify(s.props?.[l])]}))}),Array.isArray(s.description)?e.jsx(le,{language:"json",wrapLongLines:!0,className:A.tCodeBlock,children:JSON.stringify(s.description,null,2)}):e.jsx("div",{children:s.description})]},a))});const Ft={disabled:!0,style:{color:"grey"}},Qt=({answer:t,activeTab:s,activeCitation:a,citationHeight:l,className:n,onActiveTabChanged:r})=>{const u=!t.context.thoughts;t.context.data_points;const[p,f]=c.useState(""),m=async()=>{if(a){const h=a.indexOf("#")?a.split("#")[1]:"",g=await(await fetch(a,{method:"GET"})).blob();let y=URL.createObjectURL(g);h&&(y+="#"+h),f(y)}};return c.useEffect(()=>{m()},[]),e.jsx(Te,{className:n,selectedKey:s,onLinkClick:h=>h&&r(h.props.itemKey),children:e.jsx(Ne,{itemKey:T.ThoughtProcessTab,headerText:"Thought process",headerButtonProps:u?Ft:void 0,children:e.jsx(Ht,{thoughts:t.context.thoughts||[]})})})},Gt="_container_1k5c7_1",zt={container:Gt},Dt=({className:t,onClick:s})=>e.jsx("div",{className:`${zt.container} ${t??""}`,children:e.jsx(H,{icon:e.jsx(ve,{}),onClick:s,children:"Developer settings"})}),Vt="_container_1k5c7_1",Ut={container:Vt},Kt=({className:t,disabled:s,onClick:a})=>e.jsx("div",{className:`${Ut.container} ${t??""}`,children:e.jsx(H,{icon:e.jsx(Ce,{}),disabled:s,onClick:a,children:"Clear chat"})}),Wt="_container_1142u_1",Jt={container:Wt},Xt=({updateRetrievalMode:t})=>{const[s,a]=c.useState(v.Hybrid),l=(n,r)=>{a(r?.data||v.Hybrid),t(r?.data||v.Hybrid)};return e.jsx(x,{className:Jt.container,tokens:{childrenGap:10},children:e.jsx(Le,{label:"Retrieval mode",options:[{key:"hybrid",text:"Vectors + Text (Hybrid)",selected:s==v.Hybrid,data:v.Hybrid},{key:"vectors",text:"Vectors",selected:s==v.Vectors,data:v.Vectors},{key:"text",text:"Text",selected:s==v.Text,data:v.Text}],required:!0,onChange:l})})},Yt=()=>{const[t,s]=c.useState(!1),[a,l]=c.useState(""),[n,r]=c.useState(.3),[u,p]=c.useState(3),[f,m]=c.useState(v.Hybrid),[h,C]=c.useState(!0),g=c.useRef(""),y=c.useRef(null),[j,P]=c.useState(!1),[I,E]=c.useState(),[F,B]=c.useState(),[N,b]=c.useState(void 0),[L,Q]=c.useState(0),[k,G]=c.useState([]),M=async o=>{g.current=o,I&&E(void 0),P(!0),B(void 0),b(void 0);try{const S=[...k.flatMap(z=>[{content:z[0],role:"user"},{content:z[1].message.content,role:"assistant"}]),{content:o,role:"user"}],te={context:{overrides:{use_advanced_flow:h,top:u,retrieval_mode:f,prompt_template:a.length===0?void 0:a,temperature:n}}},se=await new de("/chat").getCompletion(S,te);G([...k,[o,se]])}catch(i){E(i)}finally{P(!1)}},K=()=>{g.current="",I&&E(void 0),B(void 0),b(void 0),G([]),P(!1)};c.useEffect(()=>y.current?.scrollIntoView({behavior:"smooth"}),[j]);const W=(o,i)=>{l(i||"")},J=(o,i,S)=>{r(o)},X=(o,i)=>{p(parseInt(i||"3"))},Y=(o,i)=>{C(!!i)},Z=o=>{M(o)},ee=(o,i)=>{F===o&&N===T.CitationTab&&L===i?b(void 0):(B(o),b(T.CitationTab)),Q(i)},R=(o,i)=>{b(N===o&&L===i?void 0:o),Q(i)};return e.jsxs("div",{className:d.container,children:[e.jsxs("div",{className:d.commandsContainer,children:[e.jsx(Kt,{className:d.commandButton,onClick:K,disabled:!g.current||j}),e.jsx(Dt,{className:d.commandButton,onClick:()=>s(!t)})]}),e.jsxs("div",{className:d.chatRoot,children:[e.jsxs("div",{className:d.chatContainer,children:[g.current?e.jsxs("div",{className:d.chatMessageStream,children:[k.map((o,i)=>e.jsxs("div",{children:[e.jsx($,{message:o[0]}),e.jsx("div",{className:d.chatMessageGpt,children:e.jsx(ft,{isStreaming:!1,answer:o[1],isSelected:L===i&&N!==void 0,onCitationClicked:S=>ee(S,i),onThoughtProcessClicked:()=>R(T.ThoughtProcessTab,i),onSupportingContentClicked:()=>R(T.SupportingContentTab,i),onFollowupQuestionClicked:S=>M(S)},i)})]},i)),j&&e.jsxs(e.Fragment,{children:[e.jsx($,{message:g.current}),e.jsx("div",{className:d.chatMessageGptMinWidth,children:e.jsx(jt,{})})]}),I?e.jsxs(e.Fragment,{children:[e.jsx($,{message:g.current}),e.jsx("div",{className:d.chatMessageGptMinWidth,children:e.jsx(vt,{error:I.toString(),onRetry:()=>M(g.current)})})]}):null,e.jsx("div",{ref:y})]}):e.jsxs("div",{className:d.chatEmptyState,children:[e.jsx(ye,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e.jsx("h1",{className:d.chatEmptyStateTitle,children:"Kefi Events Concierge"}),e.jsx("h2",{className:d.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e.jsx(At,{onExampleClicked:Z})]}),e.jsx("div",{className:d.chatInput,children:e.jsx(St,{clearOnSend:!0,placeholder:"Ask me anything",disabled:j,onSend:o=>M(o)})})]}),k.length>0&&N&&e.jsx(Qt,{className:d.chatAnalysisPanel,activeCitation:F,onActiveTabChanged:o=>R(o,L),citationHeight:"810px",answer:k[L][1],activeTab:N}),e.jsxs(ke,{headerText:"Configure answer generation",isOpen:t,isBlocking:!1,onDismiss:()=>s(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e.jsx(Ae,{onClick:()=>s(!1),children:"Close"}),isFooterAtBottom:!0,children:[e.jsx(Ie,{className:d.chatSettingsSeparator,checked:h,label:"Use advanced flow with query rewriting and filter formulation. Not compatible with Ollama models.",onChange:Y}),e.jsx("h3",{children:"Settings for database search:"}),e.jsx(Me,{className:d.chatSettingsSeparator,label:"Retrieve this many matching rows:",min:1,max:50,defaultValue:u.toString(),onChange:X}),e.jsx(Xt,{updateRetrievalMode:o=>m(o)}),e.jsx("h3",{children:"Settings for final chat completion:"}),e.jsx(V,{className:d.chatSettingsSeparator,defaultValue:a,label:"Override prompt template",multiline:!0,autoAdjustHeight:!0,onChange:W}),e.jsx(Pe,{className:d.chatSettingsSeparator,label:"Temperature",min:0,max:1,step:.1,defaultValue:n,onChange:J,showValue:!0,snapToStep:!0})]})]})]})};var Zt=e.jsx(Fe,{});he();const es=ue([{path:"/",element:Zt,children:[{index:!0,element:e.jsx(Yt,{})},{path:"*",lazy:()=>_e(()=>import("./NoPage-64646752.js"),["assets/NoPage-64646752.js","assets/vendor-77d51360.js"])}]}]);me.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(ge,{router:es})}));
//# sourceMappingURL=index-615b102c.js.map
